<?php
/**
 * Setup Final do Sistema Multi-Tenant IMEP Split ASAAS
 * Arquivo: setup_complete.php
 * 
 * Execute este script para configurar completamente o sistema
 */

// Verificar se j√° foi executado
$lockFile = __DIR__ . '/.setup_complete.lock';
if (file_exists($lockFile)) {
    echo "‚ö†Ô∏è  Sistema j√° foi configurado anteriormente.\n";
    echo "Para reconfigurar, delete o arquivo .setup_complete.lock e execute novamente.\n";
    exit;
}

echo "üöÄ SETUP COMPLETO - SISTEMA MULTI-TENANT IMEP SPLIT ASAAS\n";
echo "===========================================================\n\n";

try {
    // 1. Verificar depend√™ncias
    echo "1Ô∏è‚É£  VERIFICANDO DEPEND√äNCIAS\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    $required = ['curl', 'json', 'pdo', 'pdo_mysql', 'session'];
    $missing = [];
    
    foreach ($required as $ext) {
        if (!extension_loaded($ext)) {
            $missing[] = $ext;
        } else {
            echo "  ‚úÖ {$ext}\n";
        }
    }
    
    if (!empty($missing)) {
        throw new Exception("‚ùå Extens√µes PHP faltando: " . implode(', ', $missing));
    }
    
    if (version_compare(PHP_VERSION, '7.4.0', '<')) {
        throw new Exception("‚ùå PHP 7.4+ √© necess√°rio. Vers√£o atual: " . PHP_VERSION);
    }
    
    echo "  ‚úÖ PHP " . PHP_VERSION . " (Compat√≠vel)\n\n";
    
    // 2. Incluir arquivos necess√°rios
    echo "2Ô∏è‚É£  CARREGANDO SISTEMA\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    $files = [
        'config_api.php' => 'Configura√ß√µes de API',
        'config.php' => 'Configura√ß√µes do sistema',
        'auth.php' => 'Sistema de autentica√ß√£o',
        'config_manager.php' => 'Gerenciador de configura√ß√µes',
        'asaas_split_system.php' => 'Sistema ASAAS'
    ];
    
    foreach ($files as $file => $desc) {
        if (file_exists($file)) {
            require_once $file;
            echo "  ‚úÖ {$desc}\n";
        } else {
            echo "  ‚ö†Ô∏è  {$desc} (arquivo n√£o encontrado)\n";
        }
    }
    echo "\n";
    
    // 3. Configurar banco de dados
    echo "3Ô∏è‚É£  CONFIGURANDO BANCO DE DADOS\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    $db = DatabaseManager::getInstance();
    $connection = $db->getConnection();
    
    echo "  ‚úÖ Conex√£o estabelecida\n";
    echo "  üìä Banco: " . DB_NAME . " em " . DB_HOST . "\n";
    
    // Criar tabelas do sistema de autentica√ß√£o
    echo "  üîß Criando tabelas de autentica√ß√£o...\n";
    
    // Tabela de polos
    $connection->exec("
        CREATE TABLE IF NOT EXISTS polos (
            id INT AUTO_INCREMENT PRIMARY KEY,
            nome VARCHAR(255) NOT NULL,
            codigo VARCHAR(50) UNIQUE NOT NULL,
            cidade VARCHAR(100) NOT NULL,
            estado CHAR(2) NOT NULL,
            endereco TEXT,
            telefone VARCHAR(20),
            email VARCHAR(255),
            
            asaas_environment ENUM('sandbox', 'production') DEFAULT 'sandbox',
            asaas_production_api_key VARCHAR(500) NULL,
            asaas_sandbox_api_key VARCHAR(500) NULL,
            asaas_webhook_token VARCHAR(255) NULL,
            
            is_active TINYINT(1) DEFAULT 1,
            data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            data_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            
            configuracoes JSON NULL,
            
            INDEX idx_codigo (codigo),
            INDEX idx_ativo (is_active),
            INDEX idx_estado (estado)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    ");
    echo "    ‚úÖ Tabela polos\n";
    
    // Tabela de usu√°rios
    $connection->exec("
        CREATE TABLE IF NOT EXISTS usuarios (
            id INT AUTO_INCREMENT PRIMARY KEY,
            polo_id INT NULL,
            
            nome VARCHAR(255) NOT NULL,
            email VARCHAR(255) UNIQUE NOT NULL,
            senha VARCHAR(255) NOT NULL,
            
            tipo ENUM('master', 'admin_polo', 'operador') NOT NULL DEFAULT 'operador',
            permissoes JSON NULL,
            
            is_active TINYINT(1) DEFAULT 1,
            ultimo_login TIMESTAMP NULL,
            tentativas_login INT DEFAULT 0,
            bloqueado_ate TIMESTAMP NULL,
            
            data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            data_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            criado_por INT NULL,
            
            FOREIGN KEY (polo_id) REFERENCES polos(id) ON DELETE CASCADE,
            
            INDEX idx_email (email),
            INDEX idx_polo (polo_id),
            INDEX idx_tipo (tipo),
            INDEX idx_ativo (is_active)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    ");
    echo "    ‚úÖ Tabela usuarios\n";
    
    // Tabela de sess√µes
    $connection->exec("
        CREATE TABLE IF NOT EXISTS sessoes (
            id VARCHAR(128) PRIMARY KEY,
            usuario_id INT NOT NULL,
            polo_id INT NULL,
            
            ip_address VARCHAR(45),
            user_agent TEXT,
            dados_sessao JSON NULL,
            
            data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            ultima_atividade TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            expira_em TIMESTAMP NOT NULL,
            
            FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE,
            FOREIGN KEY (polo_id) REFERENCES polos(id) ON DELETE CASCADE,
            
            INDEX idx_usuario (usuario_id),
            INDEX idx_expiracao (expira_em),
            INDEX idx_ultima_atividade (ultima_atividade)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    ");
    echo "    ‚úÖ Tabela sessoes\n";
    
    // Tabela de auditoria
    $connection->exec("
        CREATE TABLE IF NOT EXISTS auditoria (
            id BIGINT AUTO_INCREMENT PRIMARY KEY,
            usuario_id INT NULL,
            polo_id INT NULL,
            
            acao VARCHAR(100) NOT NULL,
            tabela VARCHAR(50) NULL,
            registro_id VARCHAR(50) NULL,
            
            dados_anteriores JSON NULL,
            dados_novos JSON NULL,
            
            ip_address VARCHAR(45),
            user_agent TEXT,
            
            data_acao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            
            FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE SET NULL,
            FOREIGN KEY (polo_id) REFERENCES polos(id) ON DELETE SET NULL,
            
            INDEX idx_usuario (usuario_id),
            INDEX idx_polo (polo_id),
            INDEX idx_acao (acao),
            INDEX idx_data (data_acao)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    ");
    echo "    ‚úÖ Tabela auditoria\n";
    
    // Atualizar tabelas existentes para multi-tenant
    echo "  üîß Atualizando tabelas existentes...\n";
    
    $tabelas = ['customers', 'split_accounts', 'payments', 'wallet_ids'];
    
    foreach ($tabelas as $tabela) {
        // Verificar se tabela existe
        $result = $connection->query("SHOW TABLES LIKE '{$tabela}'");
        if ($result->rowCount() > 0) {
            // Verificar se j√° tem a coluna polo_id
            $result = $connection->query("SHOW COLUMNS FROM {$tabela} LIKE 'polo_id'");
            if ($result->rowCount() == 0) {
                $connection->exec("ALTER TABLE {$tabela} ADD COLUMN polo_id INT NULL AFTER id");
                $connection->exec("ALTER TABLE {$tabela} ADD INDEX idx_polo (polo_id)");
                echo "    ‚úÖ Coluna polo_id adicionada √† {$tabela}\n";
            } else {
                echo "    ‚ö™ Coluna polo_id j√° existe em {$tabela}\n";
            }
        } else {
            echo "    üìù Tabela {$tabela} ser√° criada pelo sistema principal\n";
        }
    }
    
    echo "\n";
    
    // 4. Criar dados iniciais
    echo "4Ô∏è‚É£  CRIANDO DADOS INICIAIS\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    // Polo Master
    $stmt = $connection->prepare("
        INSERT IGNORE INTO polos (nome, codigo, cidade, estado, is_active) 
        VALUES ('Administra√ß√£o Central', 'MASTER', 'S√£o Paulo', 'SP', 1)
    ");
    $stmt->execute();
    echo "  ‚úÖ Polo Master (Administra√ß√£o Central)\n";
    
    // Admin Master
    $senhaHash = password_hash('admin123', PASSWORD_DEFAULT);
    $stmt = $connection->prepare("
        INSERT IGNORE INTO usuarios (polo_id, nome, email, senha, tipo) 
        VALUES (NULL, 'Master Administrator', 'admin@imepedu.com.br', ?, 'master')
    ");
    $stmt->execute([$senhaHash]);
    echo "  üëë Master Admin criado\n";
    echo "      Email: admin@imepedu.com.br\n";
    echo "      Senha: admin123\n";
    
    // Polos de exemplo
    $polosExemplo = [
        ['IMEP - Polo S√£o Paulo', 'POLO_SP_001', 'S√£o Paulo', 'SP', 'saopaulo@imepedu.com.br'],
        ['IMEP - Polo Rio de Janeiro', 'POLO_RJ_001', 'Rio de Janeiro', 'RJ', 'rio@imepedu.com.br'],
        ['IMEP - Polo Belo Horizonte', 'POLO_MG_001', 'Belo Horizonte', 'MG', 'bh@imepedu.com.br'],
        ['IMEP - Polo Bras√≠lia', 'POLO_DF_001', 'Bras√≠lia', 'DF', 'brasilia@imepedu.com.br']
    ];
    
    foreach ($polosExemplo as $polo) {
        $stmt = $connection->prepare("
            INSERT IGNORE INTO polos (nome, codigo, cidade, estado, email, asaas_environment) 
            VALUES (?, ?, ?, ?, ?, 'sandbox')
        ");
        $stmt->execute($polo);
    }
    echo "  üè¢ 4 polos de exemplo criados\n";
    
    // Admins dos polos
    $senhaPoloHash = password_hash('polo2024', PASSWORD_DEFAULT);
    $adminsPolos = [
        [2, 'Admin S√£o Paulo', 'admin.sp@imepedu.com.br'],
        [3, 'Admin Rio de Janeiro', 'admin.rj@imepedu.com.br'],
        [4, 'Admin Belo Horizonte', 'admin.mg@imepedu.com.br'],
        [5, 'Admin Bras√≠lia', 'admin.df@imepedu.com.br']
    ];
    
    foreach ($adminsPolos as $admin) {
        $stmt = $connection->prepare("
            INSERT IGNORE INTO usuarios (polo_id, nome, email, senha, tipo) 
            VALUES (?, ?, ?, ?, 'admin_polo')
        ");
        $stmt->execute([$admin[0], $admin[1], $admin[2], $senhaPoloHash]);
    }
    echo "  üë• 4 admins de polo criados (senha: polo2024)\n";
    
    echo "\n";
    
    // 5. Configurar permiss√µes de arquivos
    echo "5Ô∏è‚É£  CONFIGURANDO PERMISS√ïES\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    $dirs = [
        __DIR__ . '/logs' => 'Logs do sistema',
        __DIR__ . '/cache' => 'Cache tempor√°rio',
        __DIR__ . '/backups' => 'Backups do banco',
        __DIR__ . '/uploads' => 'Arquivos enviados'
    ];
    
    foreach ($dirs as $dir => $desc) {
        if (!is_dir($dir)) {
            mkdir($dir, 0755, true);
            echo "  ‚úÖ Diret√≥rio criado: {$desc}\n";
        } else {
            echo "  ‚ö™ Diret√≥rio existe: {$desc}\n";
        }
        chmod($dir, 0755);
    }
    
    // Criar arquivo .htaccess para logs
    $htaccessContent = "Order Deny,Allow\nDeny from all\n";
    file_put_contents(__DIR__ . '/logs/.htaccess', $htaccessContent);
    echo "  üîí Prote√ß√£o de logs configurada\n";
    
    echo "\n";
    
    // 6. Verificar configura√ß√µes
    echo "6Ô∏è‚É£  VERIFICANDO CONFIGURA√á√ïES\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    // Verificar API Keys
    if (defined('ASAAS_PRODUCTION_API_KEY') && ASAAS_PRODUCTION_API_KEY !== '$aact_prod_000MzkwODA2MWY2OGM3MWRlMDU2NWM3MzJlNzZmNGZhZGY6OjdmNDZhZTU1LWVjYTgtNDY0Mi1hOTg5LTY0NmMxNmM1ZTFkNzo6JGFhY2hfMWYzOTgxNjEtZWRhNy00ZjhhLTk5MGQtNGYwZjY2MzJmZTJk') {
        echo "  ‚úÖ API Key Master Produ√ß√£o: Configurada\n";
    } else {
        echo "  ‚ö†Ô∏è  API Key Master Produ√ß√£o: Usar configura√ß√£o padr√£o\n";
    }
    
    if (defined('ASAAS_SANDBOX_API_KEY') && ASAAS_SANDBOX_API_KEY !== '$aact_hmlg_000MzkwODA2MWY2OGM3MWRlMDU2NWM3MzJlNzZmNGZhZGY6OjYyNTE2NTRkLTlhMmYtNGUxMS1iN2NlLTg1ZTQ5OTJjOTYyYjo6JGFhY2hfZjc5MDNiNTUtOWQ3Ny00MDRiLTg4YjctY2YxZmNhNTY5OGY5') {
        echo "  ‚úÖ API Key Master Sandbox: Configurada\n";
    } else {
        echo "  ‚ö†Ô∏è  API Key Master Sandbox: Usar configura√ß√£o padr√£o\n";
    }
    
    // Verificar URL do webhook
    if (isset($_SERVER['HTTP_HOST'])) {
        $webhookUrl = "https://" . $_SERVER['HTTP_HOST'] . dirname($_SERVER['REQUEST_URI']) . "/webhook.php";
        echo "  üîó URL do Webhook: {$webhookUrl}\n";
    }
    
    echo "\n";
    
    // 7. Criar arquivos de configura√ß√£o adicionais
    echo "7Ô∏è‚É£  CRIANDO ARQUIVOS DE CONFIGURA√á√ÉO\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    // Criar arquivo .env de exemplo
    $envContent = "# Configura√ß√µes do Sistema IMEP Split ASAAS
# Copie para .env e configure suas credenciais

# Banco de Dados
DB_HOST=localhost
DB_NAME=bankdb
DB_USER=bankuser
DB_PASS=lKVX4Ew0u7I89hAUuDCm

# ASAAS - Master (apenas para admin geral)
ASAAS_ENVIRONMENT=production
ASAAS_PRODUCTION_API_KEY=\$aact_prod_SUA_CHAVE_AQUI
ASAAS_SANDBOX_API_KEY=\$aact_hmlg_SUA_CHAVE_AQUI
ASAAS_WEBHOOK_TOKEN=seu_webhook_token_aqui

# Sistema
LOG_LEVEL=INFO
LOG_RETENTION_DAYS=30
WEBHOOK_TIMEOUT=30
";
    
    file_put_contents(__DIR__ . '/.env.example', $envContent);
    echo "  ‚úÖ Arquivo .env.example criado\n";
    
    // Criar arquivo de documenta√ß√£o
    $docContent = "# Sistema Multi-Tenant IMEP Split ASAAS

## Instala√ß√£o Conclu√≠da com Sucesso! üéâ

### Credenciais de Acesso:

**Master Administrator:**
- Email: admin@imepedu.com.br
- Senha: admin123
- Acesso: Painel completo do sistema

**Admins de Polo:**
- admin.sp@imepedu.com.br / polo2024 (S√£o Paulo)
- admin.rj@imepedu.com.br / polo2024 (Rio de Janeiro) 
- admin.mg@imepedu.com.br / polo2024 (Belo Horizonte)
- admin.df@imepedu.com.br / polo2024 (Bras√≠lia)

### URLs do Sistema:

- **Login:** login.php
- **Dashboard Master:** admin_master.php
- **Dashboard Polo:** index.php
- **Configura√ß√µes:** config_manager.php

### Pr√≥ximos Passos:

1. **Altere todas as senhas padr√£o**
2. **Configure as API Keys** de cada polo no painel de configura√ß√µes
3. **Configure a URL do webhook** no painel ASAAS
4. **Teste as conex√µes** antes de usar em produ√ß√£o

### Configura√ß√£o de APIs por Polo:

Cada polo deve ter suas pr√≥prias credenciais ASAAS configuradas:
1. Fa√ßa login como Master Admin
2. Acesse 'Configura√ß√µes de APIs'
3. Configure as credenciais de cada polo
4. Teste as conex√µes

### Suporte:

- Documenta√ß√£o: https://docs.asaas.com
- Sistema: Desenvolvido para IMEP

**‚ö†Ô∏è IMPORTANTE: Altere todas as senhas padr√£o antes de usar em produ√ß√£o!**
";
    
    file_put_contents(__DIR__ . '/INSTALACAO_COMPLETA.md', $docContent);
    echo "  üìö Documenta√ß√£o criada: INSTALACAO_COMPLETA.md\n";
    
    echo "\n";
    
    // 8. Testes finais
    echo "8Ô∏è‚É£  EXECUTANDO TESTES FINAIS\n";
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n";
    
    // Testar login
    echo "  üß™ Testando sistema de autentica√ß√£o...\n";
    $auth = new AuthSystem();
    
    $loginTest = $auth->login('admin@imepedu.com.br', 'admin123');
    if ($loginTest['success']) {
        echo "    ‚úÖ Login Master funcionando\n";
        $auth->logout(); // Limpar sess√£o de teste
    } else {
        echo "    ‚ùå Falha no teste de login: " . $loginTest['message'] . "\n";
    }
    
    // Testar banco
    $stmt = $connection->query("SELECT COUNT(*) as total FROM usuarios WHERE tipo = 'master'");
    $masterCount = $stmt->fetch()['total'];
    echo "  üìä Total de admins master: {$masterCount}\n";
    
    $stmt = $connection->query("SELECT COUNT(*) as total FROM polos WHERE is_active = 1");
    $polosCount = $stmt->fetch()['total'];
    echo "  üè¢ Total de polos ativos: {$polosCount}\n";
    
    echo "\n";
    
    // 9. Criar arquivo de lock
    file_put_contents($lockFile, json_encode([
        'setup_date' => date('Y-m-d H:i:s'),
        'version' => '2.1.0',
        'php_version' => PHP_VERSION,
        'polos_created' => $polosCount,
        'master_admins' => $masterCount
    ]));
    
    echo "‚úÖ INSTALA√á√ÉO CONCLU√çDA COM SUCESSO!\n";
    echo "===================================\n\n";
    
    echo "üéØ RESUMO DA INSTALA√á√ÉO:\n";
    echo "‚Ä¢ Sistema Multi-Tenant configurado\n";
    echo "‚Ä¢ {$polosCount} polos criados (incluindo Master)\n";
    echo "‚Ä¢ " . ($masterCount + 4) . " usu√°rios criados\n";
    echo "‚Ä¢ Todas as tabelas configuradas\n";
    echo "‚Ä¢ Permiss√µes de arquivos ajustadas\n";
    echo "‚Ä¢ Sistema de auditoria ativo\n\n";
    
    echo "üîë CREDENCIAIS PRINCIPAIS:\n";
    echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n";
    echo "‚îÇ MASTER ADMIN                            ‚îÇ\n";
    echo "‚îÇ Email: admin@imepedu.com.br             ‚îÇ\n";
    echo "‚îÇ Senha: admin123                         ‚îÇ\n";
    echo "‚îÇ URL: " . (isset($_SERVER['HTTP_HOST']) ? "https://{$_SERVER['HTTP_HOST']}/login.php" : "login.php") . str_repeat(' ', max(0, 25 - strlen(isset($_SERVER['HTTP_HOST']) ? "https://{$_SERVER['HTTP_HOST']}/login.php" : "login.php"))) . "‚îÇ\n";
    echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n";
    
    echo "üìã PR√ìXIMAS A√á√ïES OBRIGAT√ìRIAS:\n";
    echo "1. üîê Altere TODAS as senhas padr√£o\n";
    echo "2. ‚öôÔ∏è  Configure as API Keys dos polos\n";
    echo "3. üîó Configure o webhook no painel ASAAS\n";
    echo "4. üß™ Teste todas as funcionalidades\n";
    echo "5. üìö Leia o arquivo INSTALACAO_COMPLETA.md\n\n";
    
    if (isset($_SERVER['HTTP_HOST'])) {
        echo "üåê ACESSO DIRETO:\n";
        echo "https://{$_SERVER['HTTP_HOST']}/login.php\n\n";
    }
    
    echo "‚ö†Ô∏è  SEGURAN√áA: Delete este arquivo (setup_complete.php) ap√≥s a instala√ß√£o!\n\n";
    echo "üéâ Sistema pronto para uso!\n";
    
} catch (Exception $e) {
    echo "\n‚ùå ERRO NA INSTALA√á√ÉO:\n";
    echo "====================\n";
    echo "Erro: " . $e->getMessage() . "\n";
    echo "Arquivo: " . $e->getFile() . "\n";
    echo "Linha: " . $e->getLine() . "\n\n";
    
    echo "üîß SOLU√á√ïES POSS√çVEIS:\n";
    echo "‚Ä¢ Verifique as credenciais do banco de dados\n";
    echo "‚Ä¢ Verifique as permiss√µes de arquivos\n";
    echo "‚Ä¢ Verifique se todas as extens√µes PHP est√£o instaladas\n";
    echo "‚Ä¢ Verifique se o MySQL est√° rodando\n\n";
    
    echo "üìû Se o problema persistir, verifique:\n";
    echo "‚Ä¢ Logs do PHP: " . ini_get('error_log') . "\n";
    echo "‚Ä¢ Logs do MySQL\n";
    echo "‚Ä¢ Configura√ß√µes do servidor\n";
    
    exit(1);
}
?>